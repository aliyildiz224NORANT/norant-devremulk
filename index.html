<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8" />
  <title>NORANT Devrem√ºlk Satƒ±≈ü Paneli</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root{
      --bg:#fff;--fg:#0f172a;--muted:#64748b;--line:#e2e8f0;--accent:#2563eb;
      --soldBg:#ffe8e6;--soldText:#991b1b;--maintBg:#fff7d6;--maintText:#78350f;
      --kpi:#f8fafc;--ok:#16a34a;--warn:#f59e0b;
    }
    body{margin:0;background:var(--bg);color:var(--fg);font-family:system-ui,Segoe UI,sans-serif}
    .wrap{padding:20px;max-width:1400px;margin:auto}
    .head{display:flex;justify-content:space-between;flex-wrap:wrap;align-items:center;margin-bottom:8px}
    .title{font-size:24px;font-weight:800}.subtitle{color:var(--muted);font-weight:600}
    .buttons{display:flex;gap:8px;flex-wrap:wrap}.btn{padding:8px 12px;border:1px solid var(--line);border-radius:10px;background:#fff;cursor:pointer;font-weight:600}
    .btn-primary{background:var(--accent);color:#fff;border-color:var(--accent)}
    .saveState{font-size:12px;color:var(--muted)}.saveState.saved{color:var(--ok)}.saveState.saving{color:var(--warn)}
    .kpis{display:grid;grid-template-columns:repeat(5,minmax(220px,1fr));gap:10px;margin:12px 0 10px}
    .villaKpis{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:8px;margin-bottom:16px}
    .kpi,.vk{background:var(--kpi);border:1px solid var(--line);border-radius:12px;padding:12px}
    .kpi .cap,.vk .cap{font-size:12px;color:var(--muted)}.kpi .val,.vk .val{font-size:17px;font-weight:800}
    .toolbar{display:flex;flex-wrap:wrap;gap:8px;align-items:center;margin:10px 0}
    .search{padding:8px;border:1px solid var(--line);border-radius:10px;min-width:320px}
    .legend{font-size:12px;color:var(--muted)}.pill{border:1px solid var(--line);padding:4px 8px;border-radius:999px;font-size:12px}
    .tableWrap{border:1px solid var(--line);border-radius:12px;overflow:auto;max-height:60vh}
    table{border-collapse:separate;border-spacing:0;min-width:1200px}
    thead th{position:sticky;top:0;background:#f3f4f6;border-bottom:1px solid var(--line);z-index:2}
    th,td{padding:8px 10px;border-bottom:1px solid var(--line);white-space:nowrap}
    tbody td:first-child,thead th:first-child{position:sticky;left:0;background:#f8fafc;z-index:1}
    .cell{border:1px solid var(--line);border-radius:8px;padding:5px 8px;display:inline-block;cursor:pointer}
    .sold{background:var(--soldBg);color:var(--soldText)}.maint{background:var(--maintBg);color:var(--maintText)}
    .note{font-size:11px;color:#475569;display:block;margin-top:2px;max-width:160px;overflow:hidden;text-overflow:ellipsis}
    dialog::backdrop{background:rgba(0,0,0,.25)}
    dialog{border:1px solid var(--line);border-radius:12px;padding:0;max-width:700px;width:92%}
    .dlg-head{padding:14px 16px;border-bottom:1px solid var(--line);font-weight:800;display:flex;justify-content:space-between}
    .dlg-tabs{display:flex;gap:6px}.tab{padding:6px 10px;border:1px solid var(--line);border-radius:999px;font-size:12px;cursor:pointer}.tab.active{background:#eef2ff;border-color:#c7d2fe}
    .dlg-body{padding:16px;display:none}.dlg-body.active{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    .dlg-row{display:flex;flex-direction:column;gap:4px}.dlg-row input,.dlg-row textarea,.dlg-row select{padding:8px;border:1px solid var(--line);border-radius:8px}
    .dlg-foot{display:flex;justify-content:flex-end;gap:8px;padding:12px 16px;border-top:1px solid var(--line)}
    @keyframes flash{0%{box-shadow:0 0 0 0 rgba(37,99,235,.7)}100%{box-shadow:0 0 0 8px rgba(37,99,235,0)}}.flash{animation:flash .9s ease-out 0s 2}
    .ctx{position:absolute;background:#fff;border:1px solid var(--line);border-radius:10px;box-shadow:0 6px 18px rgba(0,0,0,.1);padding:4px 0;display:none;z-index:9999}
    .ctx .i{padding:8px 12px;cursor:pointer}.ctx .i:hover{background:#f3f4f6}
  </style>
</head>
<body>
<div class="wrap">
  <div class="head">
    <div>
      <div class="title">NORANT Devrem√ºlk Satƒ±≈ü Paneli</div>
      <div class="subtitle">K√º√ß√ºk yatƒ±rƒ±mlarla b√ºy√ºk getiriler</div>
    </div>
    <div class="buttons">
      <span id="saveState" class="saveState">Kaydedildi</span>
      <button id="exportCsv" class="btn">Excel (CSV)</button>
      <button id="backupJson" class="btn">Yedek indir (JSON)</button>
      <button id="copyJson" class="btn">üìã Panoya kopyala (JSON)</button>
      <label class="btn">Yedek y√ºkle<input id="restoreJson" type="file" accept="application/json" style="display:none"/></label>
      <button id="resetAll" class="btn">Sƒ±fƒ±rla</button>
    </div>
  </div>
  <div id="kpis" class="kpis"></div>
  <div id="villaKpis" class="villaKpis"></div>
  <div class="toolbar">
    <input id="search" class="search" placeholder="M√º≈üteri, tarih veya villa ara..."/>
    <span class="legend">Renkler: <span class="cell maint">Bakƒ±m</span> <span class="cell sold">Satƒ±ldƒ±</span></span>
  </div>
  <div class="tableWrap">
    <table><thead id="thead"></thead><tbody id="tbody"></tbody></table>
  </div>
</div>

<dialog id="editDlg"><div class="dlg-head"><div id="dlgTitle"></div>
<div class="dlg-tabs"><button class="tab active" data-tab="sale">Satƒ±≈ü</button><button class="tab" data-tab="pay">√ñdeme</button></div></div>
<div id="tab-sale" class="dlg-body active">
<div class="dlg-row"><label>Durum</label><select id="fStatus"><option>Bo≈ü</option><option>Satƒ±ldƒ±</option></select></div>
<div class="dlg-row"><label>M√º≈üteri</label><input id="fCustomer"></div>
<div class="dlg-row"><label>Telefon</label><input id="fPhone"></div>
<div class="dlg-row"><label>Liste (TL)</label><input id="fList" type="number"></div>
<div class="dlg-row"><label>ƒ∞ndirim (%)</label><input id="fDisc" type="number"></div>
<div class="dlg-row"><label>Net (TL)</label><input id="fNet" disabled></div>
<div class="dlg-row" style="grid-column:1/3"><label>Not</label><textarea id="fNote"></textarea></div>
</div>
<div id="tab-pay" class="dlg-body">
<div class="dlg-row"><label>Pe≈üinat (%)</label><input id="pDownPct" type="number"></div>
<div class="dlg-row"><label>Taksit (Ay)</label><input id="pInst" type="number"></div>
<div class="dlg-row"><label>√ñdenen (TL)</label><input id="pPaid" type="number"></div>
<div class="dlg-row"><label>Kalan (TL)</label><input id="pRemain" disabled></div>
</div>
<div class="dlg-foot"><button id="dlgCancel" class="btn">ƒ∞ptal</button><button id="dlgSave" class="btn btn-primary">Kaydet</button></div>
</dialog>
<div id="ctx" class="ctx"></div>

<script>
const WEEKS=["12-19 Aralƒ±k","19-26 Aralƒ±k","26-3 Ocak","3-10 Ocak","10-17 Ocak","17-24 Ocak"];
const MAINT=new Set(["17-24 Ocak"]);
const VILLAS=[{name:"Ihlamur 1"},{name:"Ihlamur 2"},{name:"Zeytin 1"},{name:"Zeytin 2"},{name:"Zambak 1"},{name:"Zambak 2"}];
const KEY="norant-satis-data";
const KAR=0.6,KDV=0.18,GV=0.2;
let STATE={},saveTimer;function empty(){return{status:"Bo≈ü",list:0,disc:0,net:0,customer:"",phone:"",note:""}}
function init(){try{STATE=JSON.parse(localStorage.getItem(KEY))||{}}catch{STATE={}}for(const v of VILLAS){if(!STATE[v.name])STATE[v.name]={};for(const w of WEEKS){STATE[v.name][w]=STATE[v.name][w]||empty()}}}
function save(){clearTimeout(saveTimer);document.getElementById("saveState").textContent="Kaydediliyor...";saveTimer=setTimeout(()=>{localStorage.setItem(KEY,JSON.stringify(STATE));document.getElementById("saveState").textContent="Kaydedildi"},300)}
function fmt(n){return Number(n||0).toLocaleString("tr-TR")}
function occ(v){let s=0,r=0,l=0,k=0,g=0;for(const w of WEEKS){const x=STATE[v][w];if(x.status==="Satƒ±ldƒ±"){s++;r+=x.net;l+=x.list;const kx=x.list*KAR;k+=kx;g+=kx*GV}}return{occ:Math.round(s/WEEKS.length*100),rev:r,kar:k,gv:g,kdv:r*KDV}}
function global(){let s=0,t=VILLAS.length*WEEKS.length,r=0,k=0,g=0,kv=0,l=0;for(const v of VILLAS){const o=occ(v.name);s+=o.occ;o.rev&&(r+=o.rev,k+=o.kar,g+=o.gv,kv+=o.kdv,l+=o.rev/KAR*100/60)}return{occ:Math.round(s/VILLAS.length),rev:r,kar:k,gv:g,kdv:kv,net:k-g}}
function render(){const th=document.getElementById("thead"),tb=document.getElementById("tbody");th.innerHTML="<tr><th>Villa</th>"+WEEKS.map(w=>`<th>${MAINT.has(w)?w+" üõ†Ô∏è":w}</th>`).join("")+"</tr>";
tb.innerHTML=VILLAS.map(v=>`<tr><td>${v.name}</td>`+WEEKS.map(w=>{const x=STATE[v.name][w],c=["cell"];if(x.status==="Satƒ±ldƒ±")c.push("sold");if(MAINT.has(w))c.push("maint");return`<td><span class="${c.join(" ")}" data-v="${v.name}" data-w="${w}">${x.status}</span>${x.note?`<span class="note">${x.note}</span>`:""}</td>`}).join("")+"</tr>").join("");tb.querySelectorAll(".cell").forEach(e=>e.onclick=()=>edit(e.dataset.v,e.dataset.w))}
function renderKpis(){const g=global();document.getElementById("kpis").innerHTML=[`<div class=kpi><div class=cap>Doluluk</div><div class=val>%${g.occ}</div></div>`,`<div class=kpi><div class=cap>Ciro</div><div class=val>${fmt(g.rev)} TL</div></div>`,`<div class=kpi><div class=cap>K√¢r</div><div class=val>${fmt(g.kar)} TL</div></div>`,`<div class=kpi><div class=cap>Vergi</div><div class=val>${fmt(g.kdv+g.gv)} TL</div></div>`,`<div class=kpi><div class=cap>Net K√¢r</div><div class=val>${fmt(g.net)} TL</div></div>`].join("");
document.getElementById("villaKpis").innerHTML=VILLAS.map(v=>{const o=occ(v.name);return`<div class=vk><div class=cap>${v.name}</div><div class=val>%${o.occ} ‚Ä¢ ${fmt(o.rev)} TL</div></div>`}).join("")}
function edit(v,w){const d=document.getElementById("editDlg"),x=STATE[v][w];document.getElementById("dlgTitle").textContent=v+" ‚Äî "+w;
fStatus.value=x.status;fCustomer.value=x.customer;fPhone.value=x.phone;fList.value=x.list;fDisc.value=x.disc;fNet.value=x.net;fNote.value=x.note;
document.getElementById("dlgSave").onclick=()=>{x.status=fStatus.value;x.customer=fCustomer.value;x.phone=fPhone.value;x.list=+fList.value;x.disc=+fDisc.value;x.net=Math.round(x.list*(1-x.disc/100));x.note=fNote.value;save();render();renderKpis();d.close()};
document.getElementById("dlgCancel").onclick=()=>d.close();d.showModal()}
document.getElementById("resetAll").onclick=()=>{if(confirm("T√ºm veriler silinsin mi?")){STATE={};init();save();render();renderKpis()}}
document.getElementById("backupJson").onclick=()=>{const blob=new Blob([JSON.stringify(STATE,null,2)],{type:"application/json"});const a=document.createElement("a");a.href=URL.createObjectURL(blob);a.download="norant_satis_yedek.json";a.click()}
document.getElementById("copyJson").onclick=async()=>{await navigator.clipboard.writeText(JSON.stringify(STATE,null,2));alert("Veriler panoya kopyalandƒ± ‚úÖ")}
document.getElementById("restoreJson").onchange=e=>{const f=e.target.files[0];if(!f)return;const r=new FileReader();r.onload=()=>{try{STATE=JSON.parse(r.result);save();render();renderKpis();alert("Yedek y√ºklendi ‚úÖ")}catch{alert("Dosya hatalƒ±")}};r.readAsText(f)}
init();render();renderKpis();
</script>
</body>
</html>
